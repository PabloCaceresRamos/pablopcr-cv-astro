---
// Data
import { jobs } from "../../data/jobsData";

// Cálculo de experiencia total
let totalMonths = 0;
jobs.forEach(job => {
  const timeStr = job.time[0];
  const [startStr, endStr] = timeStr.split(" - ");

  const parseDate = (str) => {
    if (str.toLowerCase() === "actualidad") return new Date();
    const [month, year] = str.split("/");
    return new Date(parseInt(year), parseInt(month) - 1);
  };

  const startDate = parseDate(startStr);
  const endDate = parseDate(endStr);

  let months = (endDate.getFullYear() - startDate.getFullYear()) * 12;
  months -= startDate.getMonth();
  months += endDate.getMonth();
  
  totalMonths += (months + 1);
});

const years = Math.floor(totalMonths / 12);
const remainingMonths = totalMonths % 12;

let experienceString = "";
if (years > 0) {
  experienceString += `${years} ${years === 1 ? "año" : "años"}`;
}
if (remainingMonths > 0) {
  if (years > 0) experienceString += " y ";
  experienceString += `${remainingMonths} ${remainingMonths === 1 ? "mes" : "meses"}`;
}
---

<section class="site-container experience mt-16 mx-auto max-w-6xl px-4">
  <h2
    class="text-4xl font-bold flex flex-col items-center gap-6 text-center whitespace-nowrap text-white md:flex-row md:items-center md:text-start"
  >
    <span class="drop-shadow-[2px_2px_0_#7836cf]">Mi Experiencia</span>
    <span
      class="hidden h-1.5 grow rounded-lg drop-shadow-[2px_2px_0_#0debd8] bg-[#7836cf] md:block"
    ></span>
  </h2>

  <!-- Contador de Experiencia -->
  <div class="text-center mt-8 mb-10">
    <p class="text-xl text-gray-300 font-medium">
      Experiencia Total: <span class="text-[#69c7c7] font-bold text-2xl">{experienceString}</span>
    </p>
  </div>

  <div class="mt-10 grid grid-cols-1 md:grid-cols-2 gap-6">
    {
      jobs.map((job) => {
        const parts = job.title.split(" - ");
        const company = parts.pop();
        const role = parts.join(" - ");
        
        return (
        <div class="bg-gray-900 p-6 rounded-2xl shadow-lg drop-shadow-[4px_4px_0_#7836cf] flex items-center gap-6 hover:scale-[1.02] transition-transform duration-300">
          <!-- Imagen -->
          <div class="w-20 h-20 flex-shrink-0 bg-white rounded-xl p-2 flex items-center justify-center">
            <img
              src={job.imagen}
              alt={`Logo de ${company}`}
              class="max-h-full max-w-full object-contain"
            />
          </div>

          <!-- Contenido -->
          <div class="flex-grow">
            <h3 class="text-xl font-bold text-[#69c7c7] leading-tight">{role}</h3>
            <span class="text-lg font-semibold text-[#a27ed1] mt-1 block">{company}</span>
          </div>
        </div>
      )})
    }
  </div>
</section>
